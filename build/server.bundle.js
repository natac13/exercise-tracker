!function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=5)}([function(e,r){e.exports=require("chalk")},function(e,r){e.exports=require("mongoose")},function(e,r){e.exports=require("express")},function(e,r){e.exports=require("path")},function(e,r){e.exports=require("date-fns/fp/format")},function(e,r,t){e.exports=t(10)},function(e,r){e.exports=require("body-parser")},function(e,r){e.exports=require("cors")},function(e,r){e.exports=require("dotenv")},function(e,r){e.exports=require("@babel/types")},function(e,r,t){"use strict";t.r(r);var n=t(0),o=t.n(n),s=t(3),a=t.n(s),u=t(1),i=t.n(u);function c(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{},n=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.forEach(function(r){d(e,r,t[r])})}return e}function d(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}i.a.Promise=global.Promise;const l={useNewUrlParser:!0,useFindAndModify:!1,useCreateIndex:!0};var f=async function(e,r){if("development"===e){i.a.set("debug",!0);try{const e=await i.a.connect(r,c({},l,{user:process.env.DB_USER,pass:process.env.DB_PASS,dbName:process.env.DB}));return console.log(o.a.green("\nConnected to the development Database üè¨")),console.log(o.a.yellow("Good Luck! üçå")),e}catch(e){return console.log(o.a.red(e)),Promise.reject(new Error("Failed to connect to development DB"))}}else if("production"===e)try{const e=await i.a.connect(r,c({},l,{autoIndex:!1,user:process.env.DB_USER,pass:process.env.DB_PASS,dbName:process.env.DB}));return console.log(o.a.cyan("Connected on production Database üè¨")),e}catch(e){return Promise.reject(new Error("Failed to connect to mongoDB"))}return!1},p=t(2),b=t.n(p);const m=new u.Schema({username:String});var y=i.a.model("User",m);const g=b.a.Router();g.post("/new-user",async(e,r,t)=>{const{body:n}=e,{username:o}=n;if(!o)return t();await y.findOne({username:o})&&r.json({error:"User already exist."});const s=await y.create({username:o}),a={username:s.username,_id:s._id};r.json(a).status(200)});var v=g,j=t(4),O=t.n(j);const w=new u.Schema({userId:String,description:String,duration:Number,date:Date});var x=i.a.model("Exercise",w);t(9);function P(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}const S=b.a.Router();S.post("/add",async(e,r,t)=>{const{body:n}=e,{userId:o,description:s,duration:a,date:u}=n;if(!n)return t();if(!o||!s||!a)return r.json({error:"Missing fields that are required."});const i=await y.findById(o);if(!i)return r.json({error:`No user with given id: ${o}`});const c={username:i.username,description:s,duration:a,date:u,userId:o},d=await x.create(c);return r.json({_id:d.id,username:i.username,description:d.description,duration:d.duration,date:O()("yyyy-MM-dd")(d.date)})}),S.get("/log",async(e,r,t)=>{const{query:n}=e;console.log(n);const{userId:o,from:s,to:a,limit:u}=n;if(!o)return r.send("Required a userId to search.");const i={userId:o};s&&(i.date={$gte:s}),a&&(i.date=function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{},n=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.forEach(function(r){P(e,r,t[r])})}return e}({},i.date,{$lte:a}));const c=parseInt(u,10);if(c||0===c){const e=await x.find(i,{__v:0}).limit(c);return r.json(e).status(200)}const d=await x.find(i,{__v:0});return r.json(d).status(200)});var _=S;const h=t(2),D=h(),q=t(6),I=t(7);t(8).config();f("production",process.env.MONGO_URI);D.use(I()),D.use(q.urlencoded({extended:!1})),D.use(q.json()),D.use("/css",h.static(a.a.resolve(__dirname,"..","public"))),D.get("/",(e,r)=>{r.sendFile(a.a.resolve(__dirname,"..","views/index.html"))}),D.use("/api/exercise",v,_),D.use((e,r,t)=>t({status:404,message:"not found"})),D.use((e,r,t,n)=>{let o,s;if(e.errors){o=400;const r=Object.keys(e.errors);s=e.errors[r[0]].message}else o=e.status||500,s=e.message||"Internal Server Error";t.status(o).type("txt").send(s)});const B=process.env.PORT||3033;D.set("port",B),D.listen(B,()=>console.log(o.a.green("üëè Production Server Running on port: "),o.a.bold(B)))}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiY2hhbGtcIiIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJtb25nb29zZVwiIiwid2VicGFjazovLy9leHRlcm5hbCBcImV4cHJlc3NcIiIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJwYXRoXCIiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiZGF0ZS1mbnMvZnAvZm9ybWF0XCIiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiYm9keS1wYXJzZXJcIiIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJjb3JzXCIiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiZG90ZW52XCIiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiQGJhYmVsL3R5cGVzXCIiLCJ3ZWJwYWNrOi8vLy4vc2VydmVyL2RiQ29ubmVjdGlvbi5qcyIsIndlYnBhY2s6Ly8vLi9zZXJ2ZXIvbW9kZWxzL3VzZXIuanMiLCJ3ZWJwYWNrOi8vLy4vc2VydmVyL3JvdXRlcy91c2VyLmpzIiwid2VicGFjazovLy8uL3NlcnZlci9tb2RlbHMvZXhlcmNpc2UuanMiLCJ3ZWJwYWNrOi8vLy4vc2VydmVyL3JvdXRlcy9leGVyY2lzZS5qcyIsIndlYnBhY2s6Ly8vLi9zZXJ2ZXIvaW5kZXguanMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJyZXF1aXJlIiwibW9uZ29vc2UiLCJQcm9taXNlIiwiZ2xvYmFsIiwib3B0aW9ucyIsInVzZU5ld1VybFBhcnNlciIsInVzZUZpbmRBbmRNb2RpZnkiLCJ1c2VDcmVhdGVJbmRleCIsImNvbm5lY3RUb0RCIiwiYXN5bmMiLCJlbnYiLCJtb25nb1VSSSIsInNldCIsImNvbm5lY3Rpb24iLCJjb25uZWN0IiwiX29iamVjdFNwcmVhZCIsInVzZXIiLCJwcm9jZXNzIiwiREJfVVNFUiIsInBhc3MiLCJEQl9QQVNTIiwiZGJOYW1lIiwiREIiLCJjb25zb2xlIiwibG9nIiwiY2hhbGsiLCJncmVlbiIsInllbGxvdyIsImVycm9yIiwicmVkIiwicmVqZWN0IiwiRXJyb3IiLCJhdXRvSW5kZXgiLCJjeWFuIiwiVXNlclNjaGVtYSIsIlNjaGVtYSIsInVzZXJuYW1lIiwiU3RyaW5nIiwibW9kZWwiLCJyb3V0ZXIiLCJleHByZXNzIiwiUm91dGVyIiwicG9zdCIsInJlcSIsInJlcyIsIm5leHQiLCJib2R5IiwiVXNlciIsImZpbmRPbmUiLCJqc29uIiwibmV3VXNlciIsImpzb25SZXMiLCJfaWQiLCJzdGF0dXMiLCJFeGVyY2lzZVNjaGVtYSIsInVzZXJJZCIsImRlc2NyaXB0aW9uIiwiZHVyYXRpb24iLCJOdW1iZXIiLCJkYXRlIiwiRGF0ZSIsImZpbmRCeUlkIiwiZXhlcmNpc2VEb2MiLCJuZXdFeGVyY2lzZSIsIkV4ZXJjaXNlIiwiaWQiLCJmb3JtYXQiLCJxdWVyeSIsImZyb20iLCJ0byIsImxpbWl0Iiwic2VuZCIsImNvbmRpdGlvbnMiLCIkZ3RlIiwiZXhlcmNpc2Vfb2JqZWN0U3ByZWFkIiwiJGx0ZSIsImxpbWl0TnVtYmVyIiwicGFyc2VJbnQiLCJleGVyc2ljZXMiLCJmaW5kIiwiX192IiwiYXBwIiwiYm9keVBhcnNlciIsImNvcnMiLCJjb25maWciLCJkYkNvbm5lY3Rpb24iLCJNT05HT19VUkkiLCJ1c2UiLCJ1cmxlbmNvZGVkIiwiZXh0ZW5kZWQiLCJzdGF0aWMiLCJwYXRoIiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsInNlbmRGaWxlIiwidXNlclJvdXRlIiwiZXhlcmNpc2VSb3V0ZSIsIm1lc3NhZ2UiLCJlcnIiLCJlcnJDb2RlIiwiZXJyTWVzc2FnZSIsImVycm9ycyIsImtleXMiLCJ0eXBlIiwicG9ydCIsIlBPUlQiLCJsaXN0ZW4iLCJib2xkIl0sIm1hcHBpbmdzIjoiYUFDQSxJQUFBQSxFQUFBLEdBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFDLFFBR0EsSUFBQUMsRUFBQUosRUFBQUUsR0FBQSxDQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFFBQUEsSUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBS0FGLEVBQUFRLEVBQUFGLEVBR0FOLEVBQUFTLEVBQUFWLEVBR0FDLEVBQUFVLEVBQUEsU0FBQVIsRUFBQVMsRUFBQUMsR0FDQVosRUFBQWEsRUFBQVgsRUFBQVMsSUFDQUcsT0FBQUMsZUFBQWIsRUFBQVMsRUFBQSxDQUEwQ0ssWUFBQSxFQUFBQyxJQUFBTCxLQUsxQ1osRUFBQWtCLEVBQUEsU0FBQWhCLEdBQ0Esb0JBQUFpQixlQUFBQyxhQUNBTixPQUFBQyxlQUFBYixFQUFBaUIsT0FBQUMsWUFBQSxDQUF3REMsTUFBQSxXQUV4RFAsT0FBQUMsZUFBQWIsRUFBQSxjQUFpRG1CLE9BQUEsS0FRakRyQixFQUFBc0IsRUFBQSxTQUFBRCxFQUFBRSxHQUVBLEdBREEsRUFBQUEsSUFBQUYsRUFBQXJCLEVBQUFxQixJQUNBLEVBQUFFLEVBQUEsT0FBQUYsRUFDQSxLQUFBRSxHQUFBLGlCQUFBRixRQUFBRyxXQUFBLE9BQUFILEVBQ0EsSUFBQUksRUFBQVgsT0FBQVksT0FBQSxNQUdBLEdBRkExQixFQUFBa0IsRUFBQU8sR0FDQVgsT0FBQUMsZUFBQVUsRUFBQSxXQUF5Q1QsWUFBQSxFQUFB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d0JBRTlCckQsRUFDR1MsT0FBTzhDLEdBQ1BJLEtBQUssT0FDTGhDLEtBQUs2QixLQUdWLE1BQU1JLEVBQU92RixRQUFRUCxJQUFJK0YsTUFBUSxLQUNqQ3hCLEVBQUlyRSxJQUFJLE9BQVE0RixHQUVkdkIsRUFBSXlCLE9BQU9GLEVBQU0sSUFDZmpGLFFBQVFDLElBQ05DLElBQU1DLE1BQU0sMENBQ1pELElBQU1rRixLQUFLSCIsImZpbGUiOiJzZXJ2ZXIuYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDUpO1xuIiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwiY2hhbGtcIik7IiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwibW9uZ29vc2VcIik7IiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwiZXhwcmVzc1wiKTsiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJwYXRoXCIpOyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcImRhdGUtZm5zL2ZwL2Zvcm1hdFwiKTsiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJib2R5LXBhcnNlclwiKTsiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJjb3JzXCIpOyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcImRvdGVudlwiKTsiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJAYmFiZWwvdHlwZXNcIik7IiwiaW1wb3J0IG1vbmdvb3NlIGZyb20gJ21vbmdvb3NlJztcbmltcG9ydCBjaGFsayBmcm9tICdjaGFsayc7XG5tb25nb29zZS5Qcm9taXNlID0gZ2xvYmFsLlByb21pc2U7XG5jb25zdCBvcHRpb25zID0ge1xuICB1c2VOZXdVcmxQYXJzZXI6IHRydWUsXG4gIHVzZUZpbmRBbmRNb2RpZnk6IGZhbHNlLFxuICB1c2VDcmVhdGVJbmRleDogdHJ1ZSxcbn07XG5cbmFzeW5jIGZ1bmN0aW9uIGNvbm5lY3RUb0RCKGVudiwgbW9uZ29VUkkpIHtcbiAgaWYgKGVudiA9PT0gJ2RldmVsb3BtZW50Jykge1xuICAgIG1vbmdvb3NlLnNldCgnZGVidWcnLCB0cnVlKTtcbiAgICAvLyBjb25uZWN0IHRvIGEgZGV2ZWxvcG1lbnQgZGF0YWJhc2VcbiAgICB0cnkge1xuICAgICAgY29uc3QgY29ubmVjdGlvbiA9IGF3YWl0IG1vbmdvb3NlLmNvbm5lY3QobW9uZ29VUkksIHtcbiAgICAgICAgLi4ub3B0aW9ucyxcbiAgICAgICAgdXNlcjogcHJvY2Vzcy5lbnYuREJfVVNFUixcbiAgICAgICAgcGFzczogcHJvY2Vzcy5lbnYuREJfUEFTUyxcbiAgICAgICAgZGJOYW1lOiBwcm9jZXNzLmVudi5EQixcbiAgICAgIH0pO1xuICAgICAgY29uc29sZS5sb2coY2hhbGsuZ3JlZW4oJ1xcbkNvbm5lY3RlZCB0byB0aGUgZGV2ZWxvcG1lbnQgRGF0YWJhc2Ug8J+PrCcpKTtcbiAgICAgIGNvbnNvbGUubG9nKGNoYWxrLnllbGxvdygnR29vZCBMdWNrISDwn42MJykpO1xuICAgICAgcmV0dXJuIGNvbm5lY3Rpb247XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUubG9nKGNoYWxrLnJlZChlcnJvcikpO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcignRmFpbGVkIHRvIGNvbm5lY3QgdG8gZGV2ZWxvcG1lbnQgREInKSk7XG4gICAgfVxuICB9IGVsc2UgaWYgKGVudiA9PT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBhd2FpdCBtb25nb29zZS5jb25uZWN0KG1vbmdvVVJJLCB7XG4gICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgIGF1dG9JbmRleDogZmFsc2UsXG4gICAgICAgIHVzZXI6IHByb2Nlc3MuZW52LkRCX1VTRVIsXG4gICAgICAgIHBhc3M6IHByb2Nlc3MuZW52LkRCX1BBU1MsXG4gICAgICAgIGRiTmFtZTogcHJvY2Vzcy5lbnYuREIsXG4gICAgICB9KTtcbiAgICAgIGNvbnNvbGUubG9nKGNoYWxrLmN5YW4oJ0Nvbm5lY3RlZCBvbiBwcm9kdWN0aW9uIERhdGFiYXNlIPCfj6wnKSk7XG4gICAgICByZXR1cm4gY29ubmVjdGlvbjtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gc2hvdWxkIHJlY29yZCBlcnJvciBpbiBwcm9kdWN0aW9uXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCdGYWlsZWQgdG8gY29ubmVjdCB0byBtb25nb0RCJykpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNvbm5lY3RUb0RCO1xuIiwiaW1wb3J0IG1vbmdvb3NlLCB7IFNjaGVtYSB9IGZyb20gJ21vbmdvb3NlJztcblxuY29uc3QgVXNlclNjaGVtYSA9IG5ldyBTY2hlbWEoe1xuICB1c2VybmFtZTogU3RyaW5nLFxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IG1vbmdvb3NlLm1vZGVsKCdVc2VyJywgVXNlclNjaGVtYSk7XG4iLCJpbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJztcbmltcG9ydCBVc2VyIGZyb20gJy4uL21vZGVscy91c2VyJztcblxuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcblxucm91dGVyLnBvc3QoJy9uZXctdXNlcicsIGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICBjb25zdCB7IGJvZHkgfSA9IHJlcTtcblxuICBjb25zdCB7IHVzZXJuYW1lIH0gPSBib2R5O1xuICBpZiAoIXVzZXJuYW1lKSB7XG4gICAgcmV0dXJuIG5leHQoKTtcbiAgfVxuICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kT25lKHsgdXNlcm5hbWUgfSk7XG4gIGlmICh1c2VyKSB7XG4gICAgcmVzLmpzb24oeyBlcnJvcjogJ1VzZXIgYWxyZWFkeSBleGlzdC4nIH0pO1xuICB9XG4gIGNvbnN0IG5ld1VzZXIgPSBhd2FpdCBVc2VyLmNyZWF0ZSh7IHVzZXJuYW1lIH0pO1xuXG4gIGNvbnN0IGpzb25SZXMgPSB7XG4gICAgdXNlcm5hbWU6IG5ld1VzZXIudXNlcm5hbWUsXG4gICAgX2lkOiBuZXdVc2VyLl9pZCwgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICB9O1xuICByZXMuanNvbihqc29uUmVzKS5zdGF0dXMoMjAwKTtcbn0pO1xuXG5leHBvcnQgZGVmYXVsdCByb3V0ZXI7XG4iLCJpbXBvcnQgbW9uZ29vc2UsIHsgU2NoZW1hIH0gZnJvbSAnbW9uZ29vc2UnO1xuXG5jb25zdCBFeGVyY2lzZVNjaGVtYSA9IG5ldyBTY2hlbWEoe1xuICB1c2VySWQ6IFN0cmluZyxcbiAgZGVzY3JpcHRpb246IFN0cmluZyxcbiAgZHVyYXRpb246IE51bWJlcixcbiAgZGF0ZTogRGF0ZSxcbn0pO1xuXG5leHBvcnQgZGVmYXVsdCBtb25nb29zZS5tb2RlbCgnRXhlcmNpc2UnLCBFeGVyY2lzZVNjaGVtYSk7XG4iLCJpbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJztcbmltcG9ydCBmb3JtYXQgZnJvbSAnZGF0ZS1mbnMvZnAvZm9ybWF0JztcbmltcG9ydCBVc2VyIGZyb20gJy4uL21vZGVscy91c2VyJztcbmltcG9ydCBFeGVyY2lzZSBmcm9tICcuLi9tb2RlbHMvZXhlcmNpc2UnO1xuaW1wb3J0IHsgb3B0aW9uYWxDYWxsRXhwcmVzc2lvbiB9IGZyb20gJ0BiYWJlbC90eXBlcyc7XG5cbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5cbnJvdXRlci5wb3N0KCcvYWRkJywgYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIGNvbnN0IHsgYm9keSB9ID0gcmVxO1xuICBjb25zdCB7IHVzZXJJZCwgZGVzY3JpcHRpb24sIGR1cmF0aW9uLCBkYXRlIH0gPSBib2R5O1xuICBpZiAoIWJvZHkpIHtcbiAgICByZXR1cm4gbmV4dCgpO1xuICB9XG5cbiAgaWYgKCF1c2VySWQgfHwgIWRlc2NyaXB0aW9uIHx8ICFkdXJhdGlvbikge1xuICAgIHJldHVybiByZXMuanNvbih7IGVycm9yOiBgTWlzc2luZyBmaWVsZHMgdGhhdCBhcmUgcmVxdWlyZWQuYCB9KTtcbiAgfVxuXG4gIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKHVzZXJJZCk7XG4gIGlmICghdXNlcikge1xuICAgIHJldHVybiByZXMuanNvbih7IGVycm9yOiBgTm8gdXNlciB3aXRoIGdpdmVuIGlkOiAke3VzZXJJZH1gIH0pO1xuICB9XG5cbiAgY29uc3QgZXhlcmNpc2VEb2MgPSB7XG4gICAgdXNlcm5hbWU6IHVzZXIudXNlcm5hbWUsXG4gICAgZGVzY3JpcHRpb24sXG4gICAgZHVyYXRpb24sXG4gICAgZGF0ZSxcbiAgICB1c2VySWQsXG4gIH07XG5cbiAgY29uc3QgbmV3RXhlcmNpc2UgPSBhd2FpdCBFeGVyY2lzZS5jcmVhdGUoZXhlcmNpc2VEb2MpO1xuICByZXR1cm4gcmVzLmpzb24oe1xuICAgIF9pZDogbmV3RXhlcmNpc2UuaWQsXG4gICAgdXNlcm5hbWU6IHVzZXIudXNlcm5hbWUsXG4gICAgZGVzY3JpcHRpb246IG5ld0V4ZXJjaXNlLmRlc2NyaXB0aW9uLFxuICAgIGR1cmF0aW9uOiBuZXdFeGVyY2lzZS5kdXJhdGlvbixcbiAgICBkYXRlOiBmb3JtYXQoJ3l5eXktTU0tZGQnKShuZXdFeGVyY2lzZS5kYXRlKSxcbiAgfSk7XG59KTtcblxucm91dGVyLmdldCgnL2xvZycsIGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICBjb25zdCB7IHF1ZXJ5IH0gPSByZXE7XG4gIGNvbnNvbGUubG9nKHF1ZXJ5KTtcbiAgY29uc3QgeyB1c2VySWQsIGZyb20sIHRvLCBsaW1pdCB9ID0gcXVlcnk7XG5cbiAgaWYgKCF1c2VySWQpIHtcbiAgICByZXR1cm4gcmVzLnNlbmQoJ1JlcXVpcmVkIGEgdXNlcklkIHRvIHNlYXJjaC4nKTtcbiAgfVxuICBjb25zdCBvcHRpb25zID0ge307XG4gIGNvbnN0IGNvbmRpdGlvbnMgPSB7IHVzZXJJZCB9O1xuICBpZiAoZnJvbSkge1xuICAgIGNvbmRpdGlvbnMuZGF0ZSA9IHsgJGd0ZTogZnJvbSB9O1xuICB9XG4gIGlmICh0bykge1xuICAgIGNvbmRpdGlvbnMuZGF0ZSA9IHsgLi4uY29uZGl0aW9ucy5kYXRlLCAkbHRlOiB0byB9O1xuICB9XG4gIGNvbnN0IGxpbWl0TnVtYmVyID0gcGFyc2VJbnQobGltaXQsIDEwKTtcbiAgaWYgKGxpbWl0TnVtYmVyIHx8IGxpbWl0TnVtYmVyID09PSAwKSB7XG4gICAgY29uc3QgZXhlcnNpY2VzID0gYXdhaXQgRXhlcmNpc2UuZmluZChjb25kaXRpb25zLCB7IF9fdjogMCB9KS5saW1pdChcbiAgICAgIGxpbWl0TnVtYmVyXG4gICAgKTtcbiAgICByZXR1cm4gcmVzLmpzb24oZXhlcnNpY2VzKS5zdGF0dXMoMjAwKTtcbiAgfVxuICBjb25zdCBleGVyc2ljZXMgPSBhd2FpdCBFeGVyY2lzZS5maW5kKGNvbmRpdGlvbnMsIHsgX192OiAwIH0pO1xuICByZXR1cm4gcmVzLmpzb24oZXhlcnNpY2VzKS5zdGF0dXMoMjAwKTtcbn0pO1xuXG5leHBvcnQgZGVmYXVsdCByb3V0ZXI7XG4iLCJpbXBvcnQgY2hhbGsgZnJvbSAnY2hhbGsnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgZGJDb25uZWN0aW9uIGZyb20gJy4vZGJDb25uZWN0aW9uJztcblxuY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbmNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcbmNvbnN0IGJvZHlQYXJzZXIgPSByZXF1aXJlKCdib2R5LXBhcnNlcicpO1xuXG5jb25zdCBjb3JzID0gcmVxdWlyZSgnY29ycycpO1xuLyogTm9kZSBlbnYgKi9cbnJlcXVpcmUoJ2RvdGVudicpLmNvbmZpZygpO1xuXG4vLyBSb3V0ZXJzXG5pbXBvcnQgdXNlclJvdXRlIGZyb20gJy4vcm91dGVzL3VzZXInO1xuaW1wb3J0IGV4ZXJjaXNlUm91dGUgZnJvbSAnLi9yb3V0ZXMvZXhlcmNpc2UnO1xuXG5jb25zdCBlbnYgPSBwcm9jZXNzLmVudi5OT0RFX0VOVjtcbi8qIENvbm5lY3QgdG8gdGhlIERhdGFCYXNlICovXG5jb25zdCBkYiA9IGRiQ29ubmVjdGlvbihlbnYsIHByb2Nlc3MuZW52Lk1PTkdPX1VSSSk7XG5jb25zdCBpblByb2R1Y3Rpb24gPSBlbnYgPT09ICdwcm9kdWN0aW9uJztcbmFwcC51c2UoY29ycygpKTtcblxuYXBwLnVzZShib2R5UGFyc2VyLnVybGVuY29kZWQoeyBleHRlbmRlZDogZmFsc2UgfSkpO1xuYXBwLnVzZShib2R5UGFyc2VyLmpzb24oKSk7XG5cbmFwcC51c2UoJy9jc3MnLCBleHByZXNzLnN0YXRpYyhwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4nLCAncHVibGljJykpKTtcbmFwcC5nZXQoJy8nLCAocmVxLCByZXMpID0+IHtcbiAgcmVzLnNlbmRGaWxlKHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLicsICd2aWV3cy9pbmRleC5odG1sJykpO1xufSk7XG5cbmFwcC51c2UoJy9hcGkvZXhlcmNpc2UnLCB1c2VyUm91dGUsIGV4ZXJjaXNlUm91dGUpO1xuXG4vLyBOb3QgZm91bmQgbWlkZGxld2FyZVxuYXBwLnVzZSgocmVxLCByZXMsIG5leHQpID0+IHtcbiAgcmV0dXJuIG5leHQoeyBzdGF0dXM6IDQwNCwgbWVzc2FnZTogJ25vdCBmb3VuZCcgfSk7XG59KTtcblxuLy8gRXJyb3IgSGFuZGxpbmcgbWlkZGxld2FyZVxuYXBwLnVzZSgoZXJyLCByZXEsIHJlcywgbmV4dCkgPT4ge1xuICBsZXQgZXJyQ29kZSwgZXJyTWVzc2FnZTtcblxuICBpZiAoZXJyLmVycm9ycykge1xuICAgIC8vIG1vbmdvb3NlIHZhbGlkYXRpb24gZXJyb3JcbiAgICBlcnJDb2RlID0gNDAwOyAvLyBiYWQgcmVxdWVzdFxuICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhlcnIuZXJyb3JzKTtcbiAgICAvLyByZXBvcnQgdGhlIGZpcnN0IHZhbGlkYXRpb24gZXJyb3JcbiAgICBlcnJNZXNzYWdlID0gZXJyLmVycm9yc1trZXlzWzBdXS5tZXNzYWdlO1xuICB9IGVsc2Uge1xuICAgIC8vIGdlbmVyaWMgb3IgY3VzdG9tIGVycm9yXG4gICAgZXJyQ29kZSA9IGVyci5zdGF0dXMgfHwgNTAwO1xuICAgIGVyck1lc3NhZ2UgPSBlcnIubWVzc2FnZSB8fCAnSW50ZXJuYWwgU2VydmVyIEVycm9yJztcbiAgfVxuICByZXNcbiAgICAuc3RhdHVzKGVyckNvZGUpXG4gICAgLnR5cGUoJ3R4dCcpXG4gICAgLnNlbmQoZXJyTWVzc2FnZSk7XG59KTtcblxuY29uc3QgcG9ydCA9IHByb2Nlc3MuZW52LlBPUlQgfHwgMzAzMztcbmFwcC5zZXQoJ3BvcnQnLCBwb3J0KTtcbmlmIChpblByb2R1Y3Rpb24pIHtcbiAgYXBwLmxpc3Rlbihwb3J0LCAoKSA9PlxuICAgIGNvbnNvbGUubG9nKFxuICAgICAgY2hhbGsuZ3JlZW4oJ/CfkY8gUHJvZHVjdGlvbiBTZXJ2ZXIgUnVubmluZyBvbiBwb3J0OiAnKSxcbiAgICAgIGNoYWxrLmJvbGQocG9ydClcbiAgICApXG4gICk7XG59IGVsc2Uge1xuICBhcHAubGlzdGVuKHBvcnQsICdsb2NhbGhvc3QnLCAoKSA9PiB7XG4gICAgY29uc29sZS5sb2coY2hhbGsucmVkKCdcXG4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpKTtcbiAgICBjb25zb2xlLmxvZyhjaGFsay5ncmVlbignICAgICAgICDwn5K7IERldmVsb3BtZW50IHNlcnZlciDwn4+DIG9uOiAnKSk7XG4gICAgY29uc29sZS5sb2coJyAgICAgICAgJyArIGNoYWxrLnVuZGVybGluZS5jeWFuKGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH1gKSk7XG4gICAgY29uc29sZS5sb2coY2hhbGsucmVkKCctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpKTtcbiAgfSk7XG59XG4iXSwic291cmNlUm9vdCI6IiJ9